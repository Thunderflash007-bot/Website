<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Projekte</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Gaming Projekte</h1>
        <nav>
            <ul>
                <li><a href="#projekte">Projekte</a></li>
                <li><a href="#über-uns">Über uns</a></li>
                <li><a href="#kontakt">Kontakt</a></li>
                <li id="admin-link" style="display: none;"><a href="admin.html">Admin</a></li>
                <li><a href="polls.html">Umfragen</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section id="projekte">
            <h2>Unsere Projekte</h2>
            <div class="projekt-liste">
                <!-- Projekte werden hier dynamisch eingefügt -->
            </div>
        </section>
        <section id="über-uns">
            <h2>Über uns</h2>
            <p id="about-text-display"></p>
        </section>
        <section id="kontakt">
            <h2>Kontakt</h2>
            <form id="kontakt-formular">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" placeholder="Ihr Name" required>
                <label for="discord">Discord-Benutzername:</label>
                <input type="text" id="discord" name="discord" placeholder="Ihr Discord-Name" required>
                <label for="nachricht">Nachricht:</label>
                <textarea id="nachricht" name="nachricht" placeholder="Ihre Nachricht" required></textarea>
                <button type="submit">Senden</button>
            </form>
        </section>
        <section id="neuigkeiten">
            <h2>Neuigkeiten</h2>
            <ul id="news-liste">
                <!-- Neuigkeiten werden hier dynamisch eingefügt -->
            </ul>
        </section>
    </main>
    <!-- Entferne den Footer -->
    <!-- <footer>
        <p>&copy; 2023 Gaming Projekte. Alle Rechte vorbehalten.</p>
    </footer> -->
    <script>
        // Projekte abrufen und auf der Startseite anzeigen
        function fetchProjects() {
            const projects = JSON.parse(localStorage.getItem('projects')) || [];
            const projektListe = document.querySelector('.projekt-liste');
            projektListe.innerHTML = '';
            projects.forEach(project => {
                const div = document.createElement('div');
                div.classList.add('projekt');
                div.innerHTML = `
                    <h3>${project.name}</h3>
                    <p>${project.description}</p>
                    <p>Status: ${getStatusText(project.status)}</p>
                `;
                if (project.image) {
                    const img = document.createElement('img');
                    img.src = project.image;
                    img.alt = `${project.name} Bild`;
                    img.style.maxWidth = '100%';
                    img.style.margin = '10px 0';

                    // Platzierung basierend auf der KI-Entscheidung
                    if (project.imagePlacement === 'oben') {
                        div.prepend(img);
                    } else if (project.imagePlacement === 'unten') {
                        div.appendChild(img);
                    } else if (project.imagePlacement === 'links') {
                        div.style.display = 'flex';
                        div.style.alignItems = 'center';
                        img.style.marginRight = '10px';
                        div.prepend(img);
                    } else if (project.imagePlacement === 'rechts') {
                        div.style.display = 'flex';
                        div.style.alignItems = 'center';
                        img.style.marginLeft = '10px';
                        div.appendChild(img);
                    }
                }
                projektListe.appendChild(div);
            });
        }

        // Status-Text mit Emoji basierend auf dem Status zurückgeben
        function getStatusText(status) {
            if (status === 'online') {
                return 'Online ✅'; // Grüner Haken
            } else if (status === 'offline') {
                return 'Offline ❌'; // Rotes Kreuz
            } else {
                return 'Unbekannt ❓'; // Gelbes Fragezeichen
            }
        }

        // Initiale Projekte laden
        document.addEventListener('DOMContentLoaded', fetchProjects);
    </script>
    <script>
        document.getElementById('kontakt-formular').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const discord = document.getElementById('discord').value;
            const message = document.getElementById('nachricht').value;

            try {
                const response = await fetch('/submit-message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, discord, message })
                });

                if (response.ok) {
                    alert('Nachricht erfolgreich gesendet!');
                    document.getElementById('kontakt-formular').reset();
                } else {
                    alert('Fehler beim Senden der Nachricht. Bitte versuchen Sie es später erneut.');
                }
            } catch (error) {
                console.error('Fehler beim Senden der Nachricht:', error);
                alert('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.');
            }
        });

        async function checkAllowedIp() {
            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const { ip } = await ipResponse.json();
                const allowedIpsResponse = await fetch('/allowed_ips.json');
                const allowedIps = await allowedIpsResponse.json();

                const isAllowed = allowedIps.some(entry => entry.ip === ip);
                if (isAllowed) {
                    document.getElementById('admin-link').style.display = 'block';
                }
            } catch (error) {
                console.error('Fehler beim Überprüfen der IP-Adresse:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', checkAllowedIp);
    </script>
    <script>
        // Neuigkeiten abrufen und anzeigen
        function fetchNews() {
            const news = JSON.parse(localStorage.getItem('news')) || [
                { title: 'Willkommen auf unserer Website!', content: 'Wir freuen uns, euch hier zu sehen!' },
                { title: 'Neues Update', content: 'Wir haben neue Funktionen hinzugefügt!' }
            ];
            const newsListe = document.getElementById('news-liste');
            newsListe.innerHTML = '';
            news.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${item.title}</strong><p>${item.content}</p>`;
                newsListe.appendChild(li);
            });
        }

        document.addEventListener('DOMContentLoaded', fetchNews);
    </script>
    <script>
        // Benutzername festlegen, falls nicht vorhanden
        async function setUsername() {
            const username = localStorage.getItem('username');
            if (!username) {
                const newUsername = prompt('Willkommen! Bitte gib deinen Namen ein:');
                if (newUsername) {
                    localStorage.setItem('username', newUsername);
                    alert(`Hallo ${newUsername}, dein Name wurde gespeichert!`);
                } else {
                    alert('Du musst einen Namen eingeben, um Punkte zu sammeln.');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await setUsername();
        });
    </script>
    <script>
        // Entferne die dynamische Menülogik
    </script>
    <script>
        // "Über Uns"-Text abrufen und anzeigen
        function displayAboutText() {
            const aboutText = localStorage.getItem('aboutText') || 'Wir sind ein Team von leidenschaftlichen Gamern und Entwicklern, die innovative Gaming-Projekte erstellen.';
            document.getElementById('about-text-display').textContent = aboutText;
        }

        document.addEventListener('DOMContentLoaded', displayAboutText);
    </script>
</body>
</html>
